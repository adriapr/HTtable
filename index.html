<!doctype html>
<title>Google spreadsheet to HT-table 2</title>

<script type="text/javascript">

	function csvToArray(text) {
		let p = '', row = [''], ret = [row], i = 0, r = 0, s = !0, l;
		for (l of text) {
			if ('"' === l) {
				if (s && l === p) row[i] += l;
				s = !s;
			} else if (',' === l && s) l = row[++i] = '';
			else if ('\n' === l && s) {
				if ('\r' === p) row[i] = row[i].slice(0, -1);
				row = ret[++r] = [l = '']; i = 0;
			} else row[i] += l;
			p = l;
		}
		return ret;
	};

	function loadData() {

		document.getElementById("info").innerHTML += "<br>Loading...";

		var url="https://docs.google.com/spreadsheets/d/1auP1O8DEJkCFXDN_-r13ieLFOLAmVbbWa8RSOpbPGrI/export?format=csv";
		xmlhttp=new XMLHttpRequest();
		xmlhttp.onreadystatechange = function() {
			if(xmlhttp.readyState == 4 && xmlhttp.status==200){

				document.getElementById("display").innerHTML += "<br>" + xmlhttp.responseText;
				document.getElementById("info").innerHTML += "<br>Data read";

				document.getElementById("info").innerHTML += "<br>Parsing...";

				var table = csvToArray(xmlhttp.responseText)
				console.log(table)

				document.getElementById("info").innerHTML += "<br>Displaying...";
				document.getElementById("display").innerHTML += "<br>" + table;



			}
			console.log(xmlhttp);
		};
		document.getElementById("info").innerHTML += "<br>Meh";
		xmlhttp.open("GET",url,true);
		xmlhttp.send(null);
	}

</script>

<html>
  <body>
	<button type="button" onclick="loadData()">Test 4</button>
	<div id="display"></div>
	<div id="info">Info</div>
  </body>
</html>
